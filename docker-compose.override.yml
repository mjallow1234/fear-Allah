version: "3.8"

services:
  backend:
    volumes:
      - ./backend:/app:cached
    environment:
      PYTHONUNBUFFERED: 1
      ENABLE_RELOAD: 0
    command: /app/scripts/dev-entrypoint.sh
    # backend is accessed by other containers using the internal network (no host port published)

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    volumes:
      - ./frontend:/app:cached
    depends_on:
      - backend

  api-proxy:
    image: nginx:alpine
    volumes:
      - ./deploy/api-proxy.conf:/etc/nginx/conf.d/default.conf:rw
    ports:
      - "18002:80"
    depends_on:
      - backend
      - frontend
