version: "3.8"

services:
  backend:
    volumes:
      - ./backend:/app:cached
    environment:
      PYTHONUNBUFFERED: 1
      ENABLE_RELOAD: 0
    command: /app/scripts/dev-entrypoint.sh
    # backend is accessed by other containers using the internal network (no host port published)

  # Frontend is served as a static build in PROD mode. The static files are mounted
  # into the `api-proxy` container at /usr/share/nginx/html and served by nginx.
  # To run in DEV mode (Vite dev server), restore the `frontend` service here.

  api-proxy:
    image: nginx:alpine
    volumes:
      - ./deploy/api-proxy.conf:/etc/nginx/conf.d/default.conf:ro
      - ./frontend/dist:/usr/share/nginx/html:ro
    ports:
      - "18002:80"
    depends_on:
      - backend
